<!DOCTYPE html>
    <meta charset="utf-8">
    <meta name="description" content="Nos amis les koalas">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=890, minimal-ui">
    <link rel="icon" href="./img/favicon.ico">
    <title>Koalas</title>
    <script src="./assets/js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="./assets/js/typed.js" type="text/javascript"></script>
    <script src="./assets/js/background-blur.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="./assets/css/main.css" />
    <body >
        <div id="content">
        </div>
    </body>
    <script>
        var fade = false;

        function render(tag) {
            // Render background
            panel = data[tag];
            if (fade) {
                $("body").fadeTo('slow', 0.3, function() {
                    $("body").css("background-image", "url('"+panel.background.content+"')");
                }).fadeTo("slow", 1);
            } else {
                $("body").css("background-image", "url('"+panel.background.content+"')");
            }

            if ("styles" in panel.background) {
                $("body").css(panel.background.styles);
            }


            // Render elements

            // Flush previous elements
            $("#content").html("");

            panel.elements.forEach(function(element) {
                switch(element.type) {
                    case "Text":
                        var div = $("<p></p>");
                        if (element.content) { div.text(element.content)}
                        div.css("position", "absolute");
                        div.css("width", "100%");
                        div.css("height", "100%");
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        if ("width" in element) { div.css("width", element.width) }
                        if ("height" in element) { div.css("height", element.height) }
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("styles" in element) { div.css(element.styles) }
                        if ("size" in element) { div.css("font-size", element.size) }
                        if ("alignment" in element) { div.css("text-align", "center") }
                        $("#content").append(div);
                        break;
                    case "Image":
                        var div = $("<img></img>");
                        div.css("position", "absolute");
                        div.attr("src", element.src);
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        div.attr("height", element.height)
                        div.attr("width", element.width)
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("styles" in element) { div.css(element.styles) }
                        $("#content").append(div);
                        break;
                    case "Button":
                        var div = $("<div class='btn'></div>").text(element.content);

                        div.css("position", "absolute");
                        div.attr("src", element.src);
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        div.css("height", element.height)
                        div.css("width", element.width)
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("size" in element) { div.css("font-size", element.size) }
                        if ("styles" in element) { div.css(element.styles) }
                        var target = element.target;

                        var next = "";
                        switch (target.type) {
                            case "Simple":
                                next = target.content;
                                break;
                            case "Random":
                                var rnd = Math.floor(Math.random() * target.content.length);
                                next = target.content[rnd];
                                break;
                        }

                        if ("effect" in target && target.effect == "fade") {
                            fn = function() {
                                fade = true;
                                $("html").css("opacity", 0);
                                render(next);
                                $("html").fadeTo('slow', 1);
                                fade = false;
                            }
                        } else {
                            fn = function() { render(next) };
                        }

                        div.click(fn);

                        $("#content").append(div);
                        break;
                    case "Custom":
                        element.fn();
                        break;

                }
            });
        }

        var data = {   "panel-1-1": {
            "background": { "content": "img/carterennes.png" },
                            "elements": [
                            { type: "Text", ids: "typed", alignment: "left", size: "18pt", content: "", positionX: "29%", positionY: "30%", width: "40%", height: "40%", classes: "text bg", styles: {"margin-left": "5px", "margin-right": "5px" } },
                                                                        { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "panel-1-2" } },
                                                                        {type: "Custom", fn: function() { $("#typed").typed({strings: ["J’avais hésité à venir à cette soirée. Je venais d’arriver à Rennes pour ma première année aux Beaux Arts. Je viens de Saint-Malo, mes amis sont restés là-bas, mes parents aussi. À Rennes, je ne connaissais personne, j’avais besoin de rencontrer du monde."], typeSpeed: 0})}}
                                        ]
        },
      "panel-1-2": {
         "background": { "content": "img/carterennes.png" },
        "elements": [
                    { type: "Text", ids: "typed", alignment: "center", size: "18pt", content: "", positionX: "29%", positionY: "15%", width: "40%", height: "55%", classes: "text bg" },

                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "panel-1-3" } },
         { type: "Custom", fn: function() { $("#typed").typed({strings: ["Tu étais dans un coin, tu buvais un verre avec tes amis, dans un échange plein de vie. Tu riais. On avait dix-neuf ans, on s’est abordé, tourné autour et assez rapidement on est tombés amoureux. On aimait les mêmes choses, la même musique. Tu t’intéressais à ma vie et moi à la tienne. Nos échanges étaient souvent passionnés, on parlait jusqu’à tard dans la nuit. Tout s’est passé très vite, on a vite eu envie de se voir toujours plus."], typeSpeed: 0 })}}
                    ]
                },

    "panel-1-3": {
         "background": { "content": "img/carterennes.png" },
        "elements": [
                    { type: "Text", alignment: "center", ids: "typed", size: "18pt", content: "", positionX: "29%", positionY: "25%", width: "40%", height: "45%", classes: "text bg" },

                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "panel-1-4" } },
         { type: "Custom", fn: function() { $("#typed").typed({strings: ["Mais on fait attention, on veut garder notre indépendance. On se voit quelques jours par semaine, un coup chez toi, un coup chez moi. Je fais des soirées avec mes amis pendant que tu vois les tiens. Comme tous les couples, les soirées de Binge Watching se multiplient, on a arrêté les séries qu’on regardait de notre côté et on a choisi celles qui nous plaisaient à nous deux."], typeSpeed: 0})}}
                    ]
                }
        }

        $(function() {
            render("panel-1-1");
        });

    </script>
</html>
