<!DOCTYPE html>
    <meta charset="utf-8">
    <meta name="description" content="Nos amis les koalas">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=890, minimal-ui">
    <link rel="icon" href="./img/favicon.ico">
    <title>Une histoire d'amour</title>
    <script src="./assets/js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="./assets/js/typed.js" type="text/javascript"></script>
    <script src="./assets/js/background-blur.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="./assets/css/main.css" />
    <body >
		<img id="background" style="position: fixed; left: 0; top: 0; width: 100%; height: 100%"></img>
        <div id="content">
        </div>
    </body>
    <script>
        var fade = false;

        function render(tag) {
            // Render background
            panel = data[tag];
            if (fade) {
                $("body").fadeTo('slow', 0, function() {
                    $("#background").attr("src", panel.background.content);
                }).fadeTo("slow", 1, function() {
                    $("#content").fadeTo('slow', 1);
                });
            } else {
                $("#background").attr("src", panel.background.content);
            }

            if ("styles" in panel.background) {
                $("body").css(panel.background.styles);
            }


            // Render elements

            // Flush previous elements
            $("#content").html("");

            panel.elements.forEach(function(element) {
                switch(element.type) {
                    case "Text":
                        var div = $("<p></p>");
                        if (element.content) { div.text(element.content)}
                        div.css("position", "absolute");
                        div.css("width", "100%");
                        div.css("height", "100%");
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        if ("width" in element) { div.css("width", element.width) }
                        if ("height" in element) { div.css("height", element.height) }
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("styles" in element) { div.css(element.styles) }
                        if ("size" in element) { div.css("font-size", element.size) }
                        if ("alignment" in element) { div.css("text-align", "center") }
                        $("#content").append(div);
                        break;
                    case "Image":
                        var div = $("<img></img>");
                        div.css("position", "absolute");
                        div.attr("src", element.src);
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        div.attr("height", element.height)
                        div.attr("width", element.width)
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("styles" in element) { div.css(element.styles) }
                        $("#content").append(div);
                        break;
                    case "Button":
                        var div = $("<div class='btn'></div>").text(element.content);

                        div.css("position", "absolute");
                        div.attr("src", element.src);
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        div.css("height", element.height)
                        div.css("width", element.width)
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("size" in element) { div.css("font-size", element.size) }
                        if ("styles" in element) { div.css(element.styles) }
                        var target = element.target;

                        var next = "";
                        switch (target.type) {
                            case "Simple":
                                next = target.content;
                                break;
                            case "Random":
                                var rnd = Math.floor(Math.random() * target.content.length);
                                next = target.content[rnd];
                                break;
                        }

                        if ("effect" in target && target.effect == "fade") {
                            fn = function() {
                                fade = true;
                                $("#content").css("opacity", 0);
                                render(next);
                                fade = false;
                            }
                        } else {
                            fn = function() { render(next) };
                        }

                        div.click(fn);

                        $("#content").append(div);
                        break;
                    case "Custom":
                        element.fn();
                        break;

                }
            });
        }

        var data = {
            "accueil": {
                "background": { "content": "./img/scaccueil.jpg" },
                "elements": [
                    { type: "Button", content: "Commencer", positionX: "42%", positionY: "81%", width: "16%", height: "30px", size: "18pt", classes: "home-btn",  target: {type: "Simple", effect: "fade", content: "city-1" } }
                ]
            },
            "city-1": {
                "background": { "content": "./img/carterennes.png" },
                "elements": [
                    { type: "Button", content: "Suite", positionX: "42%", positionY: "81%", width: "16%", height: "30px", classes: "city-btn", size: "18pt", target: {type: "Simple", content: "city-2" } },
                    {type: "Text", content: "", positionX: "15%", positionY: "15%", width: "30%", height: "40%", classes: "text bg city-txt", ids: "typed"},
                    {type: "Custom", fn: function() {
                        $("#typed").typed({strings: ["J’avais hésité à venir à cette soirée.\nJe venais d’arriver à Rennes pour ma première année aux Beaux Arts. Je viens de Saint-Malo, mes amis sont restés là-bas, mes parents aussi.\nÀ Rennes, je ne connaissais personne, j’avais besoin de rencontrer du monde..."], typeSpeed: 15});
                                                    }
                    }
                ]
            },
            "city-2": {
                "background": { "content": "./img/carterennes.png" },
                "elements": [
                    { type: "Button", content: "Suite", positionX: "42%", positionY: "81%", width: "16%", height: "30px", classes: "city-btn", size: "18pt", target: {type: "Simple", content: "city-3" } },
                    {type: "Text", content: "", positionX: "15%", positionY: "10%", width: "30%", height: "55%", classes: "text bg city-txt", ids: "typed"},
                    {type: "Custom", fn: function() {
                        $("#typed").typed({strings: ["Tu étais dans un coin, tu buvais un verre avec tes amis, dans un échange plein de vie. Tu riais. On avait dix-neuf ans, on s’est abordé, tourné autour et assez rapidement on est tombés amoureux. On aimait les mêmes choses, la même musique. Tu t’intéressais à ma vie et moi à la tienne. Nos échanges étaient souvent passionnés, on parlait jusqu’à tard dans la nuit. Tout s’est passé très vite, on a vite eu envie de se voir toujours plus."], typeSpeed: 15});
                                                    }
                    }
                ]
            },
            "city-3": {
                "background": { "content": "./img/carterennes.png" },
                "elements": [
                    { type: "Button", content: "Suite", positionX: "42%", positionY: "81%", width: "16%", height: "30px", classes: "city-btn", size: "18pt", target: {type: "Simple", content: "bar-1", effect: "fade" } },
                    {type: "Text", content: "", positionX: "15%", positionY: "10%", width: "30%", height: "50%", classes: "text bg city-txt", ids: "typed"},
                    {type: "Custom", fn: function() {
                        $("#typed").typed({strings: ["Mais on fait attention, on veut garder notre indépendance. On se voit quelques jours par semaine, un coup chez toi, un coup chez moi. Je fais des soirées avec mes amis pendant que tu vois les tiens. Comme tous les couples, les soirées de Binge Watching se multiplient, on a arrêté les séries qu’on regardait de notre côté et on a choisi celles qui nous plaisaient à nous deux."], typeSpeed: 15});
                                                    }
                    }
                ]
            },
            "bar-1": {
                "background": { "content": "./img/fondsc2.jpg" },
                "elements": [
                    { type: "Text", content: "- Qu'est ce que tu veux qu'on fasse ce soir ?", positionX: "55%", positionY: "15%", width: "35%", height: "30px", classes: "text bg bar-txt" },
                    { type: "Button", content: "Il y a une soirée de promo organisée au pub Gabriel, on y va ensemble ?", positionX: "5%", positionY: "52%", width: "30%", height: "10%", classes: "vert-align bar-btn", target: {type: "Simple", content: "bar-got" } },
                    { type: "Button", content: "On peut mater le dernier épisode de GoT chez moi.", positionX: "5%", positionY: "70%", width: "30%", height: "10%", classes: "vert-align bar-btn", target: {type: "Simple", content: "bar-got" } },
                ]
            },
            "bar-got": {
                "background": { "content": "./img/fondsc2.jpg" },
                "elements": [
                { type: "Text", content: "Camille me dit que ça lui va et qu’il a hâte de passer cette soirée avec moi.", positionX: "55%", positionY: "15%", width: "35%", height: "10%", styles: {"font-style": "italic" }, classes: "text bg bar-txt" },
                    { type: "Button", content: "On peut manger ensemble avant si tu veux si tu n’as rien d’autre de prévu.", positionX: "5%", positionY: "52%", width: "30%", height: "10%", classes: "vert-align bar-btn", target: {type: "Simple", content: "parc-1", effect: "fade" } },
                    { type: "Button", content: "On peut dormir ensemble si tu veux.", positionX: "5%", positionY: "70%", width: "30%", height: "10%", classes: "vert-align bar-btn", target: {type: "Simple", content: "parc-1", effect: "fade" } },
                ]
            },
            "bar-pub": {
                "background": { "content": "./img/fondsc2.jpg" },
                "elements": [
                { type: "Text", content: "Camille me dit que ça lui va et qu’il a hâte de passer cette soirée avec moi.", positionX: "55%", positionY: "15%", width: "35%", height: "10%", styles: {"font-style": "italic" }, classes: "text bg bar-txt" },
                    { type: "Button", content: "On peut manger ensemble avant si tu veux si tu n’as rien d’autre de prévu.", positionX: "5%", positionY: "52%", width: "30%", height: "10%", classes: "vert-align bar-btn", target: {type: "Simple", content: "parc-1", effect: "fade" } },
                    { type: "Button", content: "On peut dormir ensemble si tu veux.", positionX: "5%", positionY: "70%", width: "30%", height: "10%", classes: "vert-align bar-btn", target: {type: "Simple", content: "parc-1", effect: "fade" } },
                ]
            },
            "parc-1": {
                "background": { "content": "./img/parc.jpg" },
                "elements": [
                { type: "Text", content: "- Il y aura qui à ta soirée ?", positionX: "30%", positionY: "15%", width: "35%", height: "30px", classes: "text bg parc-txt" },
                { type: "Text", content: "- Bah, tu sais un peu tout le groupe du lycée : Lena, Selim, Raphaël, Julien et les jumelles.", positionX: "30%", positionY: "28%", width: "35%", height: "10%", classes: "text bg parc-txt" },
                { type: "Text", content: "- Il n'y aura pas ton ex ?", positionX: "30%", positionY: "46%", width: "35%", height: "30px", classes: "text bg parc-txt" },
                { type: "Text", content: "- Non je ne pense pas.", positionX: "30%", positionY: "60%", width: "35%", height: "30px", classes: "text bg parc-txt" },
                    { type: "Button", classes: "parc-btn", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "parc-2"} }
                ]
            },
            "parc-2": {
                "background": { "content": "./img/parc.jpg" },
                "elements": [
                { type: "Text", content: "Ok... Tu t'habilles comment ?", positionX: "30%", positionY: "7%", width: "35%", height: "10%", classes: "text bg parc-txt vert-align" },
                    { type: "Button", classes: "parc-btn vert-align", content: "Je pense que je vais mettre la jolie chemise que j'ai acheté hier.", positionX: "25%", positionY: "61%", width: "50%", height: "10%", size: "18pt", target: {type: "Simple", content: "parc-rep1"} },
                    { type: "Button", classes: "parc-btn vert-align", content: "Ben j'y vais comme ça, je ne me change pas.", positionX: "25%", positionY: "76%", width: "50%", height: "10%", size: "18pt", target: {type: "Simple", content: "parc-rep2"} }
                ]
            },
            "parc-rep1": {
                "background": { "content": "./img/parc.jpg" },
                "elements": [
                { type: "Text", content: "Camille n'apprécie pas que je m'apprête, de peur que je me fasse draguer.", styles: {"font-style": "italic"}, positionX: "30%", positionY: "7%", width: "35%", height: "10%", classes: "text bg parc-txt vert-align" },
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "soiree-1", effect: "fade" } }
                ]
            },
            "parc-rep2": {
                "background": { "content": "./img/parc.jpg" },
                "elements": [
                { type: "Text", content: "- Ok, c'est bien c'est pas trop sexy.", positionX: "30%", positionY: "7%", width: "35%", height: "10%", classes: "text bg parc-txt vert-align" },
                    { type: "Button", content: "Suite", classes: "parc-btn", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "soiree-1", effect: "fade" } }
                ]
            },
            "soiree-1": {
                "background": { "content": "./img/party.jpg" },
                "elements": [
                    { type: "Button", content: "Tu me manques", classes: "soiree-btn", positionX: "20%", positionY: "81%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-1", effect: "fade" } },
                    { type: "Button", content: "Ne pas répondre", classes: "soiree-btn", positionX: "60%", positionY: "81%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "soiree-2" } }
                ]
            },
            "soiree-2": {
                "background": { "content": "./img/party.jpg" },
                "elements": [
                    { type: "Button", content: "Je pars", classes: "soiree-btn", positionX: "20%", positionY: "81%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-1", effect: "fade" } },
                    { type: "Button", content: "Je reste", classes: "soiree-btn", positionX: "60%", positionY: "81%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "soiree-3" } }
                ]
            },
            "soiree-3": {
                "background": { "content": "./img/party.jpg" },
                "elements": [
                    { type: "Button", content: "Je pars", classes: "soiree-btn", positionX: "20%", positionY: "81%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-1", effect: "fade" } },
                    { type: "Button", content: "Je reste", classes: "soiree-btn", positionX: "60%", positionY: "81%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "soiree-4" } }
                ]
            },
            "soiree-4": {
                "background": { "content": "./img/party.jpg" },
                "elements": [
                    // Image du téléphone avec les textos
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-1", effect: "fade" } }
                ]
            },
            "appart-1": {
                "background": { "content": "./img/5_chez_la_victime.jpg" },
                "elements": [
                    { type: "Text", content: "- Ça s'est bien passé ta soirée ?", positionX: "25%", positionY: "3%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Text", content: "- Oui c'était super ! J'ai pu parler avec plein de gens...", positionX: "25%", positionY: "15%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Text", content: "- Pardon, je n’aurais pas dû t'embêter… Mais je t’aime, tu sais, c’est pour ça. Tu pourrais trouver tellement mieux que moi, j’ai peur que tu m’abandonnes. Je suis rien sans toi, moi… Pour me faire pardonner, je t’ai préparé un super repas. Un plat que tu adores, et j’ai rangé l’appartement... Mais vraiment, sans toi je suis rien. Je sais pas trop ce qui m’a pris. Ton ex était à la soirée, tu me l’as pas dit et pour moi, forcément c’est que tu voulais me le cacher. Je vous ai imaginé ensemble. La prochaine fois, on pourrait y aller ensemble ?", positionX: "25%", positionY: "28%", width: "50%", height: "40%", classes: "text bg appart-txt" },
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-2" } }
                ]
            },
            "appart-2": {
                "background": { "content": "./img/5_chez_la_victime.jpg" },
                "elements": [
                    { type: "Text", content: "- C’est vraiment mignon. Oui carrément, on pourrait faire ça. Mais... Quand on est ensemble, on est toujours collé…", positionX: "25%", positionY: "3%", width: "50%", height: "10%", classes: "text bg appart-txt" },
                    { type: "Text", content: "- Mais c’est normal ! On est un couple. C’est normal de pas se quitter, quand on est un couple ! Tous les amoureux font ça, ils ont leur univers à eux… J’ai besoin que tu t’investisses plus dans notre relation, si tu veux que ça marche ! Sinon, c’est que tu m’aimes pas autant que je t’aime...", positionX: "25%", positionY: "25%", width: "50%", height: "25%", classes: "text bg appart-txt" },
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-3" } }
                ]
            },
            "appart-3": {
                "background": { "content": "./img/5_chez_la_victime.jpg" },
                "elements": [
                    { type: "Text", content: "- Mais si, je t’aime ! T’as raison. Je vais faire un effort.", positionX: "25%", positionY: "10%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Text", content: "- En plus j'avais passé une mauvaise journée, tu le sais !", positionX: "25%", positionY: "25%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Text", content: "- Mais tu as toujours des mauvaises journées... Bon c'est fini, viens profiter du super repas que je t'ai préparé !", positionX: "25%", positionY: "40%", width: "50%", height: "10%", classes: "text bg appart-txt" },
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "nuit-1", effect: "fade" } }
                ]
            },
            "nuit-1": {
                "background": { "content": "./img/scnuit.jpg" },
                "elements": [
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "appart2-1", effect: "fade" } }
                ]
            },
            "appart-2-1": {
                "background": { "content": "./img/5_chez_la_victime.jpg" },
                "elements": [
                    { type: "Text", content: "Le lendemain, je me réveille tôt pour étudier. Tu restes dormir tranquillement. Je t’entends râler depuis le lit. Le bruit de la vaisselle te dérange, l’odeur du café t’insupporte. Tu te lèves du mauvais pied :", positionX: "25%", positionY: "10%", width: "50%", height: "17%", classes: "text bg appart-txt" },
                    { type: "Text", content: "- Mais reviens te coucher...", positionX: "25%", positionY: "35%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Text", content: "- Non, il faut que je travaille… Je te retrouve un peu plus tard. ", positionX: "25%", positionY: "48%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Text", content: "- Mais aller ! Viens...", positionX: "25%", positionY: "61%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-2-2" } }
                ]
            },
            "appart-2-2": {
                "background": { "content": "./img/5_chez_la_victime.jpg" },
                "elements": [
                    { type: "Text", ids: "typed", content: "", positionX: "25%", positionY: "15%", width: "50%", height: "30%", classes: "text bg appart-txt" },
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-2-3" } },
                    { type: "Custom", fn: function() {
                         $("#typed").typed({strings: ["Tu commences à glisser tes mains en dessous de mon tee-shirt… J’essaie de me dégager. J’insiste : il ne faut pas que je cède cette fois-ci. Tu comprends que je ne céderai pas. Je me retourne et je te regarde. Tes traits, je n’avais jamais vu autant d’agressivité sur ton visage ! Pour la première fois, tu me fais peur. Tu hurles, tu enrages. Je ne te reconnais plus. D’un coup, tu agrippes la cafetière."], typeSpeed: 15 });
                                                     }
                    }
                ]
            },
            "appart-2-3": {
                "background": { "content": "./img/5_chez_la_victime.jpg" },
                "elements": [
                    { type: "Text", ids: "typed", content: "", positionX: "25%", positionY: "15%", width: "50%", height: "30%", classes: "text bg appart-txt" },
                    { type: "Button", content: "Suite", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "appart-2-4"} },
                    { type: "Custom", fn: function() {
                         $("#typed").typed({strings: ['"Tu fais chier avec ton café ! Je suis fatigué, putain !" J’ai peur que tu me la balances en pleine face. Je ne sais plus ce que j’ai fait de mal… Tu continues de crier, malgré mes supplications pour t’apaiser. Je m’enfuis dans la salle de bain, les larmes aux yeux et là, j’entends la cafetière atterrir contre la porte… "Putain". Tu retournes te coucher.'], typeSpeed: 15 });
                                                     }
                    }
                ]
            },
            "appart-2-4": {
                "background": { "content": "./img/5_chez_la_victime.jpg" },
                "elements": [
                    { type: "Button", content: "Je pars", positionX: "25%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "visage", effect: "fade" } },
                    { type: "Button", content: "Je reste", positionX: "68%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "visage", effect: "fade" } }
                ]
            },
            "visage": {
                "background": { "content": "./img/scfinale.jpg" },
                "elements": [
                    { type: "Text", content: "Penses-tu avoir été témoin d'une scène de violence conjugale ?", positionX: "25%", positionY: "10%", width: "50%", height: "30px", classes: "text bg appart-txt" },
                    { type: "Button", content: "Oui", positionX: "25%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "final", effect: "fade" } },
                    { type: "Button", content: "Non", positionX: "68%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "final", effect: "fade" } }
                ]
            },
            "final": {
                "background": { "content": "./img/scfinale.jpg" },
                "elements": [
                    { type: "Button", content: "Fin", positionX: "46%", positionY: "81%", width: "80px", height: "30px", size: "18pt", target: {type: "Simple", content: "end" } }
                ]
            }
        }

        $(function() {
            render("accueil");
        });

    </script>
</html>
